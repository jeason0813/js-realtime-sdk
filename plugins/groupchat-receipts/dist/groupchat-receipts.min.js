!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var i=o(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),a=o(function(t){var e=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=e)}),u=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},c=function(t){return"object"==typeof t?null!==t:"function"==typeof t},f=function(t){if(!c(t))throw TypeError(t+" is not an object!");return t},s=function(t){try{return!!t()}catch(t){return!0}},l=!s(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),p=i.document,d=c(p)&&c(p.createElement),y=!l&&!s(function(){return 7!=Object.defineProperty((t="div",d?p.createElement(t):{}),"a",{get:function(){return 7}}).a;var t}),_=Object.defineProperty,m={f:l?Object.defineProperty:function(t,e,n){if(f(t),e=function(t,e){if(!c(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!c(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),f(n),y)try{return _(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},h=l?function(t,e,n){return m.f(t,e,{enumerable:!(1&(r=1)),configurable:!(2&r),writable:!(4&r),value:n});var r}:function(t,e,n){return t[e]=n,t},v="prototype",b=function(t,e,n){var r,o,c,f=t&b.F,s=t&b.G,l=t&b.S,p=t&b.P,d=t&b.B,y=t&b.W,_=s?a:a[e]||(a[e]={}),m=_[v],g=s?i:l?i[e]:(i[e]||{})[v];s&&(n=e);for(r in n)(o=!f&&g&&void 0!==g[r])&&r in _||(c=o?g[r]:n[r],_[r]=s&&"function"!=typeof g[r]?n[r]:d&&o?u(c,i):y&&g[r]==c?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[v]=t[v],e}(c):p&&"function"==typeof c?u(Function.call,c):c,p&&((_.virtual||(_.virtual={}))[r]=c,t&b.R&&m&&!m[r]&&h(m,r,c)))};b.F=1,b.G=2,b.S=4,b.P=8,b.B=16,b.W=32,b.U=64,b.R=128;var g=b;g(g.S+g.F*!l,"Object",{defineProperty:m.f});var w=a.Object,O=function(t,e,n){return w.defineProperty(t,e,n)},j=o(function(t){t.exports={default:O,__esModule:!0}});r(j);var M,S,P,R,T=r(o(function(t,e){e.__esModule=!0;var n,r=(n=j)&&n.__esModule?n:{default:n};e.default=function(t,e,n){return e in t?(0,r.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}})),E={}.hasOwnProperty,x=function(t,e){return E.call(t,e)},A={}.toString,C=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==(e=t,A.call(e).slice(8,-1))?t.split(""):Object(t);var e},F=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},I=function(t){return C(F(t))},k=Math.ceil,q=Math.floor,D=function(t){return isNaN(t=+t)?0:(t>0?q:k)(t)},G=Math.min,V=Math.max,z=Math.min,B=i["__core-js_shared__"]||(i["__core-js_shared__"]={}),L=0,N=Math.random(),W=B[M="keys"]||(B[M]={}),K=(S=!1,function(t,e,n){var r,o,i,a,u=I(t),c=(r=u.length)>0?G(D(r),9007199254740991):0,f=(i=c,(o=D(o=n))<0?V(o+i,0):z(o,i));if(S&&e!=e){for(;c>f;)if((a=u[f++])!=a)return!0}else for(;c>f;f++)if((S||f in u)&&u[f]===e)return S||f||0;return!S&&-1}),U=W[P="IE_PROTO"]||(W[P]="Symbol(".concat(void 0===(R=P)?"":R,")_",(++L+N).toString(36))),Y="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),H=Object.keys||function(t){return function(t,e){var n,r=I(t),o=0,i=[];for(n in r)n!=U&&x(r,n)&&i.push(n);for(;e.length>o;)x(r,n=e[o++])&&(~K(i,n)||i.push(n));return i}(t,Y)},J={f:Object.getOwnPropertySymbols},Q={f:{}.propertyIsEnumerable},X=Object.assign,Z=!X||s(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=X({},t)[n]||Object.keys(X({},e)).join("")!=r})?function(t,e){for(var n=Object(F(t)),r=arguments.length,o=1,i=J.f,a=Q.f;r>o;)for(var u,c=C(arguments[o++]),f=i?H(c).concat(i(c)):H(c),s=f.length,l=0;s>l;)a.call(c,u=f[l++])&&(n[u]=c[u]);return n}:X;g(g.S+g.F,"Object",{assign:Z});var $=a.Object.assign,tt=r(o(function(t){t.exports={default:$,__esModule:!0}})),et=o(function(t,e){!function(e){var n=function(){return"_"}.toString().indexOf("_")>-1,r=function(){},o=Object.prototype.hasOwnProperty,i=Object.create||function(t){var e=function(){};return e.prototype=t,new e},a=Object.keys||function(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e},u=function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);return t},c=Object.prototype.toString,f=Array.isArray||function(t){return"[object Array]"===c.call(t)},s=function(t){return"[object Function]"===c.call(t)},l=function(){},p=!0,d={toString:""};for(var y in d)d.hasOwnProperty(y)&&(p=!1);var _=p?["toString","valueOf"]:null;function m(t,e,r){for(var o,i,u=function(t){var e=a(t);if(p)for(var n,r=0;n=_[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(r),c=0,f=u.length;c<f;)"__self"!==(o=u[c++])&&(i=r[o],!s(i)||i.prototype&&i.prototype.__self||n&&!(i.toString().indexOf(".__base")>-1)?e[o]=i:e[o]=function(n,r){var o=t[n]?t[n]:"__constructor"===n?e.__self.__parent:l,i=function(){var t=this.__base;this.__base=i.__base;var e=r.apply(this,arguments);return this.__base=t,e};return i.__base=o,i}(o,i))}function h(t,e){for(var n,r=1;n=t[r++];)e?s(n)?v.self(e,n.prototype,n):v.self(e,n):e=s(n)?v(t[0],n.prototype,n):v(t[0],n);return e||t[0]}function v(){var t=arguments,e=f(t[0]),n=e||s(t[0]),o=n?e?h(t[0]):t[0]:r,a=t[n?1:0]||{},c=t[n?2:1],l=a.__constructor||n&&o.prototype&&o.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return o.apply(this,arguments)}:function(){};if(!n)return l.prototype=a,l.prototype.__self=l.prototype.constructor=l,u(l,c);u(l,o),l.__parent=o;var p=o.prototype,d=l.prototype=i(p);return d.__self=d.constructor=l,a&&m(p,d,a),c&&m(o,l,c),l}v.self=function(){var t=arguments,e=f(t[0])?h(t[0],t[0][0]):t[0],n=t[1],r=t[2],o=e.prototype;return n&&m(o,o,n),r&&m(e,e,r),e};var b=!0;t.exports=v,b=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(v)}),b=!1),b&&(e.inherit=v)}(n)});if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var nt=et(e.TypedMessage,{__constructor:function(t){this.__base(),this.timestamp=new Date(t)}});e.messageType(-101)(nt),e.messageField(["timestamp"])(nt),nt.sendOptions={transient:!0};var rt={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[nt],onIMClientCreate:function(t){var e=t._sendReadCommand;t._sendReadCommand=function(n){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return n.forEach(function(t){!t.transient&&t.members.length>2&&t.send(new nt(t.lastMessageAt||new Date)).catch(function(t){return console.warn("Sending groupchat receipt fail: "+t.message)})}),e.call.apply(e,[t,n].concat(o))}},onConversationCreate:function(t){var e=t.queryMessages;t.queryMessages=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return!t.transient&&t.members.length>2&&!t.lastReadTimestamps&&t._fetchAllReceiptTimestamps().then(function(e){t.lastReadTimestamps=e.reduce(function(t,e){var n=e.pid,r=e.lastReadAt;return tt(t,T({},n,r))},{}),t.emit("lastreadtimestampsupdate",t.lastReadTimestamps)}).catch(function(t){return console.warn("Initialize group receipts fail: "+t.message)}),e.call.apply(e,[t].concat(r))}},beforeMessageDispatch:function(t,e){return t.type!==nt.TYPE||(e.lastReadTimestamps&&(e.lastReadTimestamps[t.from]=t.timestamp,e.emit("lastreadtimestampsupdate",T({},t.from,t.timestamp))),!1)}};t.GroupchatReceiptsPlugin=rt,t.ReadReceipt=nt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=groupchat-receipts.min.js.map